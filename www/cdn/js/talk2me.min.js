function random(a,b){return Math.round(Math.random()*(b-a)+a)}Date.prototype.today=function(){return this.getFullYear()+"-"+(10>this.getMonth()+1?"0":"")+(this.getMonth()+1)+"-"+(10>this.getDate()?"0":"")+this.getDate()};Date.prototype.timeNow=function(){return(10>this.getHours()?"0":"")+this.getHours()+":"+(10>this.getMinutes()?"0":"")+this.getMinutes()+":"+(10>this.getSeconds()?"0":"")+this.getSeconds()};function getTimestamp(){var a=new Date;return a.today()+" "+a.timeNow()}
function sendMessage(a){if(!(void 0===a||1>a.length)){var a="<strong>@"+username+"</strong> "+a+' <span class="timestamp">'+getTimestamp()+"</span>",a=strip_tags(a,"<strong><em><table><thead><tbody><tr><th><td><img><br><br/><a><p><div><ul><li><ol><span><hr><hr/><dd><dl><dt>"),b='{"a": "message", "msg": "'+a.replace(/"/g,'\\"')+'"}';conn.send(b);handleMessage(a)}}
function handleMessage(a){isLoggedIn&&((new Audio("cdn/sounds/notification.ogg")).play(),$(".messages").append('<div class="well well-sm">'+a+"</div>"),$("html, body").animate({scrollTop:$(document).height()},1E3))}
function login(){room=$("#room").val();username=$("#username").val();if(void 0!==username&&2<username.length&&9>username.length)isLoggedIn=!0,void 0!==room&&1<room.length||(room="public"),window.location.hash=room+"@"+username,startConnection(room,username),$form='<form role="form"><input name="message" id="message" type="text" class="form-control" placeholder="@'+username+" #"+room+' type msg [enter]" /></form>',$("#login-form").replaceWith($form),$("#message").focus(),$("#message").keypress(function(a){if(13==
a.which)return a.preventDefault(),sendMessage($("#message").val()),$("#message").val(""),$("#message").focus(),!1});else return alert("Please enter a username between 3-8 characters!"),!1}function strip_tags(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return a.replace(/<\!--[\s\S]*?--\>|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,c){return-1<b.indexOf("<"+c.toLowerCase()+">")?a:""})}
function startConnection(a,b){conn=new WebSocket(webSocketUrl);conn.onopen=function(){conn.send('{"a": "login", "room":"'+a+'", "username": "'+b+'"}')};conn.onmessage=function(a){isLoggedIn&&handleMessage(a.data)}}function init(){var a=window.location.hash;username=room="";a.match(/#/)&&a.match(/@/)&&(room=a.replace(/^#(.*)@(.*)$/,"$1"),$("#room").val(room),username=a.replace(/^#(.*)@(.*)$/,"$2"),$("#username").val(username),login())}
$(document).ready(function(){isLoggedIn=!1;init();$("#room").focus();$("#room, #username").keypress(function(a){if(13==a.which)return a.preventDefault(),login(),!1});$(window).on("unload",function(){return confirm("Are you sure you want to logout?")})});
